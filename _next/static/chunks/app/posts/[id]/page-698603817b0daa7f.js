(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[880],{96:(e,t,s)=>{"use strict";s.d(t,{B:()=>d});var a=s(5155),r=s(5476),n=s(2115),i=s(9434);function l(e){let{className:t,...s}=e;return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,i.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...s})}var o=s(9629);function d(e){let{post:t,comment:s,isEditing:i,setIsEditing:d,onSubmit:u}=e,[c,m]=(0,n.useState)(!1),[p,x]=(0,n.useState)(""),g=(0,n.useRef)(null);(0,n.useEffect)(()=>{s&&x(null==s?void 0:s.body)},[]);let v=async e=>{let{name:a,body:r}=e;try{await u({name:a,body:r,postId:null==t?void 0:t.id})}catch(e){(0,o.o)({type:"error",description:s?"Error updating comment":"Error creating comment"}),m(!1),console.error(e)}finally{(0,o.o)({type:"success",description:"Comment created"}),d(!1),x(""),m(!1)}};return(0,a.jsx)(a.Fragment,{children:i?(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,a.jsx)(l,{"data-testid":"message-editor",ref:g,className:"bg-transparent outline-none overflow-hidden resize-none !text-base rounded-xl w-full",value:p,onChange:e=>{x(e.target.value)}}),(0,a.jsxs)("div",{className:"flex flex-row gap-2 justify-end",children:[(0,a.jsx)(r.$,{variant:"outline",className:"h-fit py-2 px-3",onClick:()=>{d(!1)},children:"Cancel"}),(0,a.jsx)(r.$,{"data-testid":"message-editor-send-button",variant:"default",className:"h-fit py-2 px-3",disabled:c||!p,onClick:async()=>{m(!0),v({name:"",body:p})},children:c?"Commenting...":"Comment"})]})]}):null})}},485:(e,t,s)=>{"use strict";s.d(t,{default:()=>g});var a=s(5155),r=s(3262),n=s(5476),i=s(4180),l=s(2969);let o=e=>{let{post:t,comment:s}=e,o=(0,l.jL)(),[d,{isLoading:u}]=(0,i.HI)(),c=async()=>{console.log("delComment",await d(s.id).unwrap()),o(i.FH.util.updateQueryData("getPostComments",t.id,e=>e.filter(e=>e.id!==s.id)))};return(0,a.jsx)(n.$,{variant:"ghost",onClick:c,children:(0,a.jsx)(r.uc,{})})},d=e=>{let{setIsEditing:t}=e;return(0,a.jsx)(n.$,{variant:"ghost",onClick:()=>{t(!0)},children:(0,a.jsx)(r.vL,{})})};var u=s(96),c=s(2115),m=s(4604);let p=e=>{let{comment:t,post:s}=e,r=(0,l.GV)(m.uu),[n,p]=(0,c.useState)(!1),x=(0,l.jL)(),[g,{isLoading:v}]=(0,i.DN)(),h=async e=>{var a;let{body:r}=e,n=await g({...t,body:r}).unwrap();console.log("updatedComment",n),x(i.FH.util.updateQueryData("getPostComments",null!==(a=null==s?void 0:s.id)&&void 0!==a?a:void 0,e=>{let t=e.findIndex(e=>e.id===n.id);-1!==t&&(e[t]={...e[t],...n})}))};return(0,a.jsxs)("li",{className:"grid grid-cols-12 mt-3 mb-7",children:[(0,a.jsxs)("div",{className:"col-span-11",children:[(0,a.jsx)("b",{children:(0,a.jsx)("i",{children:t.email})}),n?(0,a.jsx)(u.B,{post:s,comment:t,isEditing:n,setIsEditing:p,onSubmit:h}):(0,a.jsx)("p",{children:t.body})]}),"success"===r?(0,a.jsxs)("div",{className:"col-span-1",children:[(0,a.jsx)(d,{setIsEditing:p}),(0,a.jsx)(o,{comment:t,post:s})]}):null]})};var x=s(8856);let g=e=>{let{post:t}=e,{data:s=[],isLoading:r}=(0,i.WS)(t.id);return(0,a.jsx)(a.Fragment,{children:r?(0,a.jsxs)("div",{className:"mt-5",children:[(0,a.jsx)("hr",{className:"my-6 border-gray-300"}),[1,2,3].map(e=>(0,a.jsxs)("div",{className:"flex flex-col space-y-3 mt-10",children:[(0,a.jsx)(x.E,{className:"h-4 w-[150px]"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(x.E,{className:"h-4"}),(0,a.jsx)(x.E,{className:"h-4"}),(0,a.jsx)(x.E,{className:"h-4"})]})]},e))]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("hr",{className:"my-6 border-gray-300"}),(0,a.jsx)("ul",{children:s.map(e=>(0,a.jsx)(p,{comment:e,post:t},e.id))})]})})}},2969:(e,t,s)=>{"use strict";s.d(t,{GV:()=>n,jL:()=>r});var a=s(4540);let r=a.wA.withTypes(),n=a.d4.withTypes();a.Pj.withTypes()},4180:(e,t,s)=>{"use strict";s.d(t,{DN:()=>u,FH:()=>n,HI:()=>c,WS:()=>l,z2:()=>d});var a=s(404),r=s(694);let n=(0,a.xP)({reducerPath:"comments",baseQuery:(0,r.cw)({baseUrl:"https://jsonplaceholder.typicode.com/"}),tagTypes:["Comments"],endpoints:e=>({getComments:e.query({query:()=>"comments",providesTags:e=>e?[...e.map(e=>{let{id:t}=e;return{type:"Comments",id:t}}),{type:"Comments",id:"LIST"}]:[{type:"Comments",id:"LIST"}]}),addComment:e.mutation({query:e=>({url:"comments",method:"POST",body:e})}),getComment:e.query({query:e=>"comments/".concat(e),providesTags:(e,t,s)=>[{type:"Comments",id:s}]}),getPostComments:e.query({query:e=>"posts/".concat(e,"/comments"),providesTags:e=>e?[...e.map(e=>{let{id:t}=e;return{type:"Comments",id:t}}),{type:"Comments",id:"LIST"}]:[{type:"Comments",id:"LIST"}]}),updateComment:e.mutation({query:e=>{let{id:t,...s}=e;return{url:"comments/".concat(t),method:"PUT",body:s}}}),deleteComment:e.mutation({query:e=>({url:"comments/".concat(e),method:"DELETE"})})})}),{useGetCommentQuery:i,useGetPostCommentsQuery:l,useGetCommentsQuery:o,useAddCommentMutation:d,useUpdateCommentMutation:u,useDeleteCommentMutation:c}=n},4604:(e,t,s)=>{"use strict";s.d(t,{RJ:()=>a,iD:()=>r,uu:()=>i});let a=(0,s(5710).Z0)({name:"auth",initialState:{status:void 0},reducers:{login:e=>{e.status="success"},logout:e=>{e.status=void 0}}}),{login:r,logout:n}=a.actions,i=e=>e.auth.status;a.reducer},5706:(e,t,s)=>{"use strict";s.d(t,{Avatar:()=>y,AvatarFallback:()=>j});var a=s(5155),r=s(2115),n=s(6081),i=s(9033),l=s(2712),o=s(3655),d="Avatar",[u,c]=(0,n.A)(d),[m,p]=u(d),x=r.forwardRef((e,t)=>{let{__scopeAvatar:s,...n}=e,[i,l]=r.useState("idle");return(0,a.jsx)(m,{scope:s,imageLoadingStatus:i,onImageLoadingStatusChange:l,children:(0,a.jsx)(o.sG.span,{...n,ref:t})})});x.displayName=d;var g="AvatarImage";r.forwardRef((e,t)=>{let{__scopeAvatar:s,src:n,onLoadingStatusChange:d=()=>{},...u}=e,c=p(g,s),m=function(e,t){let[s,a]=r.useState("idle");return(0,l.N)(()=>{if(!e){a("error");return}let s=!0,r=new window.Image,n=e=>()=>{s&&a(e)};return a("loading"),r.onload=n("loaded"),r.onerror=n("error"),r.src=e,t&&(r.referrerPolicy=t),()=>{s=!1}},[e,t]),s}(n,u.referrerPolicy),x=(0,i.c)(e=>{d(e),c.onImageLoadingStatusChange(e)});return(0,l.N)(()=>{"idle"!==m&&x(m)},[m,x]),"loaded"===m?(0,a.jsx)(o.sG.img,{...u,ref:t,src:n}):null}).displayName=g;var v="AvatarFallback",h=r.forwardRef((e,t)=>{let{__scopeAvatar:s,delayMs:n,...i}=e,l=p(v,s),[d,u]=r.useState(void 0===n);return r.useEffect(()=>{if(void 0!==n){let e=window.setTimeout(()=>u(!0),n);return()=>window.clearTimeout(e)}},[n]),d&&"loaded"!==l.imageLoadingStatus?(0,a.jsx)(o.sG.span,{...i,ref:t}):null});h.displayName=v;var f=s(9434);function y(e){let{className:t,...s}=e;return(0,a.jsx)(x,{"data-slot":"avatar",className:(0,f.cn)("relative flex size-8 shrink-0 overflow-hidden rounded-full",t),...s})}function j(e){let{className:t,...s}=e;return(0,a.jsx)(h,{"data-slot":"avatar-fallback",className:(0,f.cn)("bg-muted flex size-full items-center justify-center rounded-full",t),...s})}},6967:(e,t,s)=>{"use strict";s.d(t,{default:()=>c});var a=s(5155),r=s(5695),n=s(5476),i=s(2115),l=s(96),o=s(4180),d=s(2969),u=s(4604);let c=e=>{let{post:t}=e,s=(0,r.useRouter)(),[c,m]=(0,i.useState)(!1),[p,x]=(0,i.useState)(!1),g="success"===(0,d.GV)(u.uu),v=(0,d.jL)(),[h,{isLoading:f}]=(0,o.z2)(),y=async e=>{let{name:s,body:a}=e,r=await h({name:s,email:"no-auth@gmail.com",body:a,postId:t.id}).unwrap();v(o.FH.util.updateQueryData("getPostComments",t.id,e=>{e.unshift(r)}))};return(0,a.jsxs)("div",{className:"mt-5",children:[p?null:(0,a.jsx)("div",{children:(0,a.jsx)(n.$,{onClick:()=>{g?(m(g),x(!0)):s.push("/login")},disabled:p,children:"Add comment"})}),c?(0,a.jsx)(l.B,{post:t,isEditing:p,setIsEditing:x,onSubmit:y}):null]})}},8856:(e,t,s)=>{"use strict";s.d(t,{E:()=>n});var a=s(5155),r=s(9434);function n(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"skeleton",className:(0,r.cn)("bg-accent animate-pulse rounded-md",t),...s})}},8938:(e,t,s)=>{Promise.resolve().then(s.bind(s,6967)),Promise.resolve().then(s.bind(s,485)),Promise.resolve().then(s.bind(s,5706))}},e=>{var t=t=>e(e.s=t);e.O(0,[803,555,753,545,848,441,684,358],()=>t(8938)),_N_E=e.O()}]);