(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[880],{96:(e,t,s)=>{"use strict";s.d(t,{B:()=>o});var a=s(5155),r=s(5476),n=s(2115),i=s(9434);function l(e){let{className:t,...s}=e;return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,i.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...s})}var d=s(9629);function o(e){let{post:t,comment:s,isEditing:i,setIsEditing:o,onSubmit:c}=e,[m,u]=(0,n.useState)(!1),[p,x]=(0,n.useState)(""),g=(0,n.useRef)(null);(0,n.useEffect)(()=>{s&&x(null==s?void 0:s.body)},[]);let v=async e=>{let{name:a,body:r}=e;try{await c({name:a,body:r,postId:null==t?void 0:t.id})}catch(e){(0,d.o)({type:"error",description:s?"Error updating comment":"Error creating comment"}),u(!1),console.error(e)}finally{(0,d.o)({type:"success",description:"Comment created"}),o(!1),x(""),u(!1)}};return(0,a.jsx)(a.Fragment,{children:i?(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,a.jsx)(l,{"data-testid":"message-editor",ref:g,className:"bg-transparent outline-none overflow-hidden resize-none !text-base rounded-xl w-full",value:p,onChange:e=>{x(e.target.value)}}),(0,a.jsxs)("div",{className:"flex flex-row gap-2 justify-end",children:[(0,a.jsx)(r.$,{variant:"outline",className:"h-fit py-2 px-3",onClick:()=>{o(!1)},children:"Cancel"}),(0,a.jsx)(r.$,{"data-testid":"message-editor-send-button",variant:"default",className:"h-fit py-2 px-3",disabled:m||!p,onClick:async()=>{u(!0),v({name:"",body:p})},children:m?"Commenting...":"Comment"})]})]}):null})}},485:(e,t,s)=>{"use strict";s.d(t,{default:()=>x});var a=s(5155),r=s(3262),n=s(5476),i=s(4180),l=s(2969);let d=e=>{let{post:t,comment:s}=e,d=(0,l.jL)(),[o,{isLoading:c}]=(0,i.HI)(),m=async()=>{console.log("delComment",await o(s.id).unwrap()),d(i.FH.util.updateQueryData("getPostComments",t.id,e=>e.filter(e=>e.id!==s.id)))};return(0,a.jsx)(n.$,{variant:"ghost",onClick:m,children:(0,a.jsx)(r.uc,{})})},o=e=>{let{setIsEditing:t}=e;return(0,a.jsx)(n.$,{variant:"ghost",onClick:()=>{t(!0)},children:(0,a.jsx)(r.vL,{})})};var c=s(96),m=s(2115);let u=e=>{let{comment:t,post:s}=e,[r,n]=(0,m.useState)(!1),u=(0,l.jL)(),[p,{isLoading:x}]=(0,i.DN)(),g=async e=>{var a;let{body:r}=e,n=await p({...t,body:r}).unwrap();console.log("updatedComment",n),u(i.FH.util.updateQueryData("getPostComments",null!==(a=null==s?void 0:s.id)&&void 0!==a?a:void 0,e=>{let t=e.findIndex(e=>e.id===n.id);-1!==t&&(e[t]={...e[t],...n})}))};return(0,a.jsxs)("li",{className:"grid grid-cols-12 mt-3 mb-7",children:[(0,a.jsxs)("div",{className:"col-span-11",children:[(0,a.jsx)("b",{children:(0,a.jsx)("i",{children:t.email})}),r?(0,a.jsx)(c.B,{post:s,comment:t,isEditing:r,setIsEditing:n,onSubmit:g}):(0,a.jsx)("p",{children:t.body})]}),(0,a.jsxs)("div",{className:"col-span-1",children:[(0,a.jsx)(o,{setIsEditing:n}),(0,a.jsx)(d,{comment:t,post:s})]})]})};var p=s(8856);let x=e=>{let{post:t}=e,{data:s=[],isLoading:r}=(0,i.WS)(t.id);return(0,a.jsx)(a.Fragment,{children:r?(0,a.jsxs)("div",{className:"mt-5",children:[(0,a.jsx)("hr",{className:"my-6 border-gray-300"}),[1,2,3].map(e=>(0,a.jsxs)("div",{className:"flex flex-col space-y-3 mt-10",children:[(0,a.jsx)(p.E,{className:"h-4 w-[150px]"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(p.E,{className:"h-4"}),(0,a.jsx)(p.E,{className:"h-4"}),(0,a.jsx)(p.E,{className:"h-4"})]})]},e))]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("hr",{className:"my-6 border-gray-300"}),(0,a.jsx)("ul",{children:s.map(e=>(0,a.jsx)(u,{comment:e,post:t},e.id))})]})})}},2969:(e,t,s)=>{"use strict";s.d(t,{jL:()=>r});var a=s(4540);let r=a.wA.withTypes();a.d4.withTypes(),a.Pj.withTypes()},4180:(e,t,s)=>{"use strict";s.d(t,{DN:()=>c,FH:()=>n,HI:()=>m,WS:()=>l,z2:()=>o});var a=s(404),r=s(694);let n=(0,a.xP)({reducerPath:"comments",baseQuery:(0,r.cw)({baseUrl:"https://jsonplaceholder.typicode.com/"}),tagTypes:["Comments"],endpoints:e=>({getComments:e.query({query:()=>"comments",providesTags:e=>e?[...e.map(e=>{let{id:t}=e;return{type:"Comments",id:t}}),{type:"Comments",id:"LIST"}]:[{type:"Comments",id:"LIST"}]}),addComment:e.mutation({query:e=>({url:"comments",method:"POST",body:e})}),getComment:e.query({query:e=>"comments/".concat(e),providesTags:(e,t,s)=>[{type:"Comments",id:s}]}),getPostComments:e.query({query:e=>"posts/".concat(e,"/comments"),providesTags:e=>e?[...e.map(e=>{let{id:t}=e;return{type:"Comments",id:t}}),{type:"Comments",id:"LIST"}]:[{type:"Comments",id:"LIST"}]}),updateComment:e.mutation({query:e=>{let{id:t,...s}=e;return{url:"comments/".concat(t),method:"PUT",body:s}}}),deleteComment:e.mutation({query:e=>({url:"comments/".concat(e),method:"DELETE"})})})}),{useGetCommentQuery:i,useGetPostCommentsQuery:l,useGetCommentsQuery:d,useAddCommentMutation:o,useUpdateCommentMutation:c,useDeleteCommentMutation:m}=n},5706:(e,t,s)=>{"use strict";s.d(t,{Avatar:()=>y,AvatarFallback:()=>j});var a=s(5155),r=s(2115),n=s(6081),i=s(9033),l=s(2712),d=s(3655),o="Avatar",[c,m]=(0,n.A)(o),[u,p]=c(o),x=r.forwardRef((e,t)=>{let{__scopeAvatar:s,...n}=e,[i,l]=r.useState("idle");return(0,a.jsx)(u,{scope:s,imageLoadingStatus:i,onImageLoadingStatusChange:l,children:(0,a.jsx)(d.sG.span,{...n,ref:t})})});x.displayName=o;var g="AvatarImage";r.forwardRef((e,t)=>{let{__scopeAvatar:s,src:n,onLoadingStatusChange:o=()=>{},...c}=e,m=p(g,s),u=function(e,t){let[s,a]=r.useState("idle");return(0,l.N)(()=>{if(!e){a("error");return}let s=!0,r=new window.Image,n=e=>()=>{s&&a(e)};return a("loading"),r.onload=n("loaded"),r.onerror=n("error"),r.src=e,t&&(r.referrerPolicy=t),()=>{s=!1}},[e,t]),s}(n,c.referrerPolicy),x=(0,i.c)(e=>{o(e),m.onImageLoadingStatusChange(e)});return(0,l.N)(()=>{"idle"!==u&&x(u)},[u,x]),"loaded"===u?(0,a.jsx)(d.sG.img,{...c,ref:t,src:n}):null}).displayName=g;var v="AvatarFallback",f=r.forwardRef((e,t)=>{let{__scopeAvatar:s,delayMs:n,...i}=e,l=p(v,s),[o,c]=r.useState(void 0===n);return r.useEffect(()=>{if(void 0!==n){let e=window.setTimeout(()=>c(!0),n);return()=>window.clearTimeout(e)}},[n]),o&&"loaded"!==l.imageLoadingStatus?(0,a.jsx)(d.sG.span,{...i,ref:t}):null});f.displayName=v;var h=s(9434);function y(e){let{className:t,...s}=e;return(0,a.jsx)(x,{"data-slot":"avatar",className:(0,h.cn)("relative flex size-8 shrink-0 overflow-hidden rounded-full",t),...s})}function j(e){let{className:t,...s}=e;return(0,a.jsx)(f,{"data-slot":"avatar-fallback",className:(0,h.cn)("bg-muted flex size-full items-center justify-center rounded-full",t),...s})}},6967:(e,t,s)=>{"use strict";s.d(t,{default:()=>c});var a=s(5155),r=s(5695),n=s(5476),i=s(2115),l=s(96),d=s(4180),o=s(2969);let c=e=>{let{post:t}=e;(0,r.useRouter)();let[s,c]=(0,i.useState)(!1),[m,u]=(0,i.useState)(!1),p=(0,o.jL)(),[x,{isLoading:g}]=(0,d.z2)(),v=async e=>{let{name:s,body:a}=e,r=await x({name:s,email:"no-auth@gmail.com",body:a,postId:t.id}).unwrap();p(d.FH.util.updateQueryData("getPostComments",t.id,e=>{e.unshift(r)}))};return(0,a.jsxs)("div",{className:"mt-5",children:[m?null:(0,a.jsx)("div",{children:(0,a.jsx)(n.$,{onClick:()=>{c(!0),u(!0)},disabled:m,children:"Add comment"})}),s?(0,a.jsx)(l.B,{post:t,isEditing:m,setIsEditing:u,onSubmit:v}):null]})}},8856:(e,t,s)=>{"use strict";s.d(t,{E:()=>n});var a=s(5155),r=s(9434);function n(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"skeleton",className:(0,r.cn)("bg-accent animate-pulse rounded-md",t),...s})}},8938:(e,t,s)=>{Promise.resolve().then(s.bind(s,6967)),Promise.resolve().then(s.bind(s,485)),Promise.resolve().then(s.bind(s,5706))}},e=>{var t=t=>e(e.s=t);e.O(0,[803,753,545,848,441,684,358],()=>t(8938)),_N_E=e.O()}]);